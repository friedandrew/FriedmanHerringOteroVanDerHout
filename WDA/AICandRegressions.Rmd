---
title: "AICandRegressions"
author: "Catherine Otero"
date: "4/22/2022"
output: pdf_document
---

The goal of this file is to run AICs to select variables to then incorporate into a regression evaluating AIM data and dams in Washington State.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries}
#check working directory
getwd()

#load packages
library(sf)
library(tidyverse)
library(nhdplusTools)
library(dplyr)
library(readr)
library(tmap)

# Set your ggplot theme
theme_set(theme_light())

```

Loading Scraped Data - may not need all of these
```{r load data}
WAAIM_tidy_utm <- st_read("./New Data/WAAIM_tidy.shp") %>% 
  st_transform(crs = 26910)

WAAIM_tidy_dams <- st_read("./New Data/WAAIM_tidy_dams.csv")

```

# Wrangle data
```{r wrangle data}
#Specify columns want to change to numeric
i <- c(1:58)  

#convert the columns indicated in i above to numeric
WAAIM_tidy_dams[ , i] <- apply(WAAIM_tidy_dams[ , i], 2,            
                    function(x) as.numeric(as.character(x)))

#check that all columns we want are integers
sapply(WAAIM_tidy_dams, class)

#check which columns have NAs, changed from character to numeric so can run function
colSums(is.na(WAAIM_tidy_dams))

#clean data so work with complete data
#select columns w/ variables of interest that are complete
#drop rows for sites w/ NA for TotalP&N and no invert data
#drop rows w/ NA for D50
WAAIM_clean_dams <- WAAIM_tidy_dams %>% 
  select() %>% 
  

```

# AIC Models
We use AIC models to select which explanatory variables to use in a model. It can be tempting to throw all variables with available data into a model, but that can get confusing and not actually increase the explanatory power of a model. By using AIC to select variables, we can minimize covariates and end up with a simpler model that is informative and easier to interpret.
```{r AIC}

#REMEMBER: once you clean the df replace the df below with the clean one

#AIC for total nitrogen as our dependent variable (DV)
TNAIC <- lm(data = WAAIM_tidy_dams, TotalN ~ MIDLAT + MIDLONG + BTMLAT + BTMLONG + TRLAT + TRLONG + ReachLength + StreamOrder + VEG_CMPLXTY + RPRN_VEG_CNPY_CVR + RPRN_VEG_UNDRSTRY_CVR + RPRN_VEG_GC + NON_NTVE_WDY + NTVE_WDY + NON_NTVE_HRB + NTVE_HRB + SDGE_RSH + TotalP + SpC + pH + INSTNT_TEMP + LWD_FREQ + LWDVolume + BNK_STBLTY + BNKFLL_HT + INCSN_HT + CHN_INCSN + BNKFLL_WT + WTTD_WT + Number_of_dams_upstream + OBSRVD_INVRT_RCHNSS + MACROINVRTBRTE_CNT + D50)

#Choose a model by AIC in a Stepwise Algorithm
step(TNAIC)
TNmodel <- lm(data = WAAIM_tidy_dams, TotalN ~ FILL IN)
summary(TNmodel)

#__________________________________________________

#AIC for total phosphorous as our DV
TPAIC <- lm(data = WAAIM_tidy_dams, TotalP ~ MIDLAT + MIDLONG + BTMLAT + BTMLONG + TRLAT + TRLONG + ReachLength + StreamOrder + VEG_CMPLXTY + RPRN_VEG_CNPY_CVR + RPRN_VEG_UNDRSTRY_CVR + RPRN_VEG_GC + NON_NTVE_WDY + NTVE_WDY + NON_NTVE_HRB + NTVE_HRB + SDGE_RSH + TotalN + SpC + pH + INSTNT_TEMP + LWD_FREQ + LWDVolume + BNK_STBLTY + BNKFLL_HT + INCSN_HT + CHN_INCSN + BNKFLL_WT + WTTD_WT + Number_of_dams_upstream + OBSRVD_INVRT_RCHNSS + MACROINVRTBRTE_CNT + D50)

#Choose a model by AIC in a Stepwise Algorithm
step(TPAIC)
TPmodel <- lm(data = WAAIM_tidy_dams, TotalP ~ FILL IN)
summary(TPmodel)

#___________________________________________-

#AIC for Observed Invertebrate Richness
Invert_AIC <- lm(data = WAAIM_tidy_dams, OBSRVD_INVRT_RCHNSS ~ MIDLAT + MIDLONG + BTMLAT + BTMLONG + TRLAT + TRLONG + ReachLength + StreamOrder + VEG_CMPLXTY + RPRN_VEG_CNPY_CVR + RPRN_VEG_UNDRSTRY_CVR + RPRN_VEG_GC + NON_NTVE_WDY + NTVE_WDY + NON_NTVE_HRB + NTVE_HRB + SDGE_RSH + TotalP + SpC + pH + INSTNT_TEMP + LWD_FREQ + LWDVolume + BNK_STBLTY + BNKFLL_HT + INCSN_HT + CHN_INCSN + BNKFLL_WT + WTTD_WT + Number_of_dams_upstream + TotalN + MACROINVRTBRTE_CNT + D50)

#Choose a model by AIC in a Stepwise Algorithm
step(Invert_AIC)
Invert_model <- lm(data = WAAIM_tidy_dams, OBSRVD_INVRT_RCHNSS ~ FILL IN)
summary(Invert_model)

#___________________________________________-

#AIC for Bank Full Height
bank_AIC <- lm(data = WAAIM_tidy_dams, BNKFLL_HT ~ MIDLAT + MIDLONG + BTMLAT + BTMLONG + TRLAT + TRLONG + ReachLength + StreamOrder + VEG_CMPLXTY + RPRN_VEG_CNPY_CVR + RPRN_VEG_UNDRSTRY_CVR + RPRN_VEG_GC + NON_NTVE_WDY + NTVE_WDY + NON_NTVE_HRB + NTVE_HRB + SDGE_RSH + TotalP + SpC + pH + INSTNT_TEMP + LWD_FREQ + LWDVolume + BNK_STBLTY + TotalN + INCSN_HT + CHN_INCSN + BNKFLL_WT + WTTD_WT + Number_of_dams_upstream + OBSRVD_INVRT_RCHNSS + MACROINVRTBRTE_CNT + D50)

#Choose a model by AIC in a Stepwise Algorithm
step(bank_AIC)
bank_model <- lm(data = WAAIM_tidy_dams, BNKFLL_HT ~ FILL IN)
summary(bank_model)

#___________________________________________-

#AIC for D50 aka particle sizes
D50AIC <- lm(data = WAAIM_tidy_dams, D50 ~ MIDLAT + MIDLONG + BTMLAT + BTMLONG + TRLAT + TRLONG + ReachLength + StreamOrder + VEG_CMPLXTY + RPRN_VEG_CNPY_CVR + RPRN_VEG_UNDRSTRY_CVR + RPRN_VEG_GC + NON_NTVE_WDY + NTVE_WDY + NON_NTVE_HRB + NTVE_HRB + SDGE_RSH + TotalP + SpC + pH + INSTNT_TEMP + LWD_FREQ + LWDVolume + BNK_STBLTY + BNKFLL_HT + INCSN_HT + CHN_INCSN + BNKFLL_WT + WTTD_WT + Number_of_dams_upstream + OBSRVD_INVRT_RCHNSS + MACROINVRTBRTE_CNT + TotalN)

#Choose a model by AIC in a Stepwise Algorithm
step(D50AIC)
D50model <- lm(data = WAAIM_tidy_dams, D50 ~ FILL IN)
summary(D50model)

```

#RegreSsions
We perform regressions to see if and to what extent explanatory variables influence our dependent variables. We use the common p-value of below 0.05 to indicate significant relationships.
```{r Regressions}

```


